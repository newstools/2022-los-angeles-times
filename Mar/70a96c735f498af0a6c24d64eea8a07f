A custody battle and restraining order preceded a deadly shooting Monday when a 39-year-old man killed his three children and the person assigned by the court to supervise his visits with them at a Sacramento-area church, according to court records and county authorities. Sgt. Rodney Grassmann, a spokesman for the Sacramento County Sheriff’s Office, said authorities are investigating how the man obtained  the firearm despite the court order. It was also revealed Tuesday that five days before killing his daughters, the assailant — identified as David Fidel Mora Rojas — had been arrested in Merced County for assaulting an officer and drunk driving, among other charges. Sacramento County court records show that Illeana Gutierrez Rios filed for a domestic violence restraining order in May against Mora, her then boyfriend. The court granted the order for five years and allowed a mutual friend and member of the church to serve as chaperone for Mora’s supervised visits with the couple’s three children due to his “mental instability,” according to court records. On Tuesday, the Sacramento County coroner identified the deceased  girls  as Samia Mora Gutierrez, 13, Samantha Mora Gutierrez, 11 and Samarah Mora Gutierrez, 9. The mutual friend and supervisor was identified Tuesday as Nathaniel Kong, 59. Gutierrez Rios warned the court that Mora was dangerous and she had fought for a restraining order for the girls as well, but the court ultimately granted him supervised visitations on weekends. “I have moved out of the house with the children because I am afraid of [Mora] and concerned [for] my safety and the safety of my children,” she said in court documents.  Gutierrez Rios said in court documents that Mora had been abusive for a decade and had choked her, pushed her, thrown things at her and threatened to kill her. In April, she said she called the police after an argument when he became aggressive and threatened suicide, according to court documents. Police  admitted Mora for a weeklong psychiatric hold. Gutierrez Rios and her three daughters then moved out of the Sacramento home they had shared with Mora. Their daughters had witnessed the argument, Gutierrez Rios told the court. “They were scared and crying,” she said. “My oldest child was biting her nails off.” Mora said that “he has not killed me because he would not know where to go with the children,” Gutierrez Rios said in court documents. Mora fought attempts at a protective order that would keep him from  his children, agreeing in court documents to abide by a restraining order from Gutierrez Rios but not from his three daughters. “I do not agree to the protective order for my children,” he wrote in court documents in May. “I want a healthy relationship with my children, separate from Illeana.” Detectives in Sacramento on Tuesday were still trying to sort out the chain of events that led to the gunman entering the sanctuary at the Church in Sacramento, on Wyda Way east of the city, shortly after 5 p.m. and opening fire. He then took his own life, officials said. As part of the order, Mora was repeatedly warned in court documents that he could not own or otherwise possess a gun. Law enforcement sources said he used an illegally obtained AR-15-style rifle in the shooting. Julie Bornhoeft, a domestic violence victim advocate with WEAVE Inc., a crisis intervention service in Sacramento, said people like Mora, with “a propensity for violence,” should have “completely turned in any weapons.” Bornhoeft said law enforcement only recovers weapons when it is directly involved after a restraining order is obtained. “It is left to an honor system with a person who has already hurt or threatened a partner being relied upon to abide by the law,” she said. “It is a flawed system.” Mora had a recent run-in with the law, according to Merced County authorities.  On Feb. 22, the California Highway Patrol arrested him on suspicion of driving under the influence, battery on a police officer and resisting arrest in the Los Banos area.  He was subsequently released from the Merced County jail, according to Merced County Sheriff’s Deputy Daryl Allen, a department spokesman.  Gutierrez Rios has been in contact with authorities, according to Sacramento County Sheriff Scott Jones. She did not respond to a request for comment. She was not believed to be in town at the time of the shooting and was notified by a law enforcement chaplain. “The mom — I don’t know how you process it,” Grassmann said. According to court records, Mora was only allow supervised visits with the girls. The visits were to be up to four hours with a court-approved supervisor, identified as “a mutually agreed upon person from the parents’ church.” He was also required to participate in at least 16 anger-management sessions as part of the order. The violence at the church left residents stunned. “It hurts to hear that a father shot his own three kids,” said Alicia Harmon, 16, who lives nearby. Harmon said many of her friends live close to the church, and she came down after her mother told her she might know some of those involved. The three girls attended Bannon Creek Elementary School and Leroy Greene Academy in the Natomas Unified School District, which issued a statement on Tuesday. “There are very few words that can give comfort right now for this unspeakable tragedy,” the district said, adding that it will have an emotional support team and chaplains from the Sacramento Police Department available to provide grief counseling and support. “There will be a range of emotions from our students and staff, particularly at the schools where the students attended.” Michael Baginski, who was described as a district leader on the church’s website, suggested the shooter was mentally ill. Baginski was not at the scene and said the church was not holding services at the time of the shooting. Mays reported from Sacramento and Winton from Los Angeles. Times staff writers Jessica Garrison and James Queally contributed to this report.